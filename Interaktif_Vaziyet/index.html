<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>EPP 4NM - İnteraktif Vaziyet Planı</title>

  <!-- Material Symbols Outlined (MD3 ikon seti) -->
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

  <!-- CSS Files: Base structure + Components -->
  <link rel="stylesheet" href="styles/base.css" />
  <link rel="stylesheet" href="styles/components.css" />
</head>
<body>
<header>
  <img src="img/logo.png" alt="Logo" class="logo" />
  <span class="ivp">İnteraktif Vaziyet Planı</span>
  <div class="toolbar-separator"></div>
  <!-- Proje adı (dışarıda kalsın) -->
  <span id="projectNameLabel" class="projectName" style="display:none;"></span>

  <div class="spacer"></div>

  <!-- Proje bilgileri (menüye girmiyor, dışarıda kalıyor) -->
  <button id="projectInfoBtn"
          class="icon-top-button"
          title="Proje bilgileri"
          style="display:none">
    <span class="material-symbols-outlined">apartment</span>
  </button>

  <!-- Mode toggle (viewer / editor) -> Dışarıda kalacak -->
  <div class="mode-toggle" id="modeToggle">
    <button class="material-symbols-outlined active" data-mode="viewer">visibility</button>
    <button class="material-symbols-outlined" data-mode="editor">edit</button>
  </div>

  <!-- HAMBURGER MENÜ -->
  <div class="header-menu">
    <!-- Checkbox hack ile aç/kapa -->
    <input type="checkbox" id="headerMenuToggle" class="header-menu-checkbox">

    <!-- Menü düğmesi -->
    <label for="headerMenuToggle"
           class="icon-top-button header-menu-button"
           title="Menü">
      <span class="material-symbols-outlined">menu</span>
    </label>

    <!-- Dropdown içeriği -->
    <div class="header-menu-dropdown">
      <!-- Son kayıt bilgisi -->
      <div class="header-menu-section">
        <span class="header-menu-label">Dosya</span>
        <span id="lastExportLabel" class="chip last-export">Son kayıt: -</span>
      </div>

      <!-- Ayarlar / PIN / Hakkında -->
      <div class="header-menu-section">
        <span class="header-menu-label">Araçlar</span>

        <button id="passwordSettingsBtn"
                class="icon-top-button"
                title="Düzenleme PIN'i"
                style="display:none">
          <span class="material-symbols-outlined">vpn_key</span>
        </button>

        <button id="settingsBtn"
                class="icon-top-button"
                title="Ayarlar"
                style="display:none">
          <span class="material-symbols-outlined">settings</span>
        </button>

        <button id="aboutBtn"
                class="icon-top-button"
                title="Hakkında">
          <span class="material-symbols-outlined">info</span>
        </button>
      </div>
    </div>
  </div>
</header>


  <main>
    <div class="canvas-column">
      <div class="toolbar">
        <label
          id="mainImageWrapper"
          class="icon-button"
          title="Ana görsel yükle (yalnızca düzenleme modunda)"
          style="display:none">
          <span class="material-symbols-outlined">image</span>
          <input type="file" id="mainImageInput" accept="image/*">
        </label>

        <label title="İmalat görünümü">
          <select id="workViewSelect"></select>
        </label>
        
        <span id="workViewStats" class="chip" style="display:none;font-size:11px;"></span>

        <button id="resetViewBtn" title="Görünümü sıfırla">
          <span class="material-symbols-outlined">restart_alt</span>
        </button>
        <button id="panModeBtn" title="Pan modunu aç/kapat">
          <span class="material-symbols-outlined">pan_tool_alt</span>
        </button>
        <button id="labelsBtn" title="Blok etiketlerini göster/gizle">
          <span class="material-symbols-outlined">label</span>
        </button>
        <button id="exportBtn" title="Kaydet">
          <span class="material-symbols-outlined">save</span>
        </button>
        <button id="importBtn" title="Aç">
          <span class="material-symbols-outlined">folder_open</span>
        </button>

        <div class="toolbar-separator"></div>

        <button id="summaryBtn" title="Puantaj">
          <span class="material-symbols-outlined">groups</span>
        </button>
        <button id="readyBtn" title="Başlayabilir İmalatlar">
          <span class="material-symbols-outlined">play_circle</span>
        </button>
        <button id="issuesBtn" title="İmalat Sorunları">
          <span class="material-symbols-outlined">warning</span>
        </button>

        <input type="file" id="importInput" accept=".epp,.zip,application/zip" style="display:none">
      </div>

      <div class="draw-toolbar" id="drawToolbar" style="display:none">
        <button id="addBlockBtn" title="Yeni blok oluştur">
          <span class="material-symbols-outlined">add_box</span>
        </button>
        <button id="drawLineBtn" title="Çizgi çiz">
          <span class="material-symbols-outlined">show_chart</span>
        </button>
        <button id="drawCurveBtn" title="Eğri çiz">
          <span class="material-symbols-outlined">timeline</span>
        </button>
        <button id="addTextBtn" title="Metin ekle">
          <span class="material-symbols-outlined">text_fields</span>
        </button>
      </div>

      <div class="canvas-wrapper" id="canvasWrapper">
        <div id="viewport">
          <img id="mainImage" alt="Vaziyet planı">
          <svg id="drawingLayer" style="position:absolute;top:0;left:0;pointer-events:none;width:100%;height:100%;"></svg>
          <div id="textLayer" style="position:absolute;top:0;left:0;pointer-events:none;"></div>
          <div id="hotspotLayer"></div>
        </div>
      </div>
    </div>

    <div id="asideBackdrop" class="aside-backdrop"></div>
    <aside>
      <header>Detaylar</header>
      <div class="side-body" id="sideBody"></div>
    </aside>
  </main>

  <!-- Hakkında -->
  <div id="aboutOverlay" class="modal-backdrop">
    <div class="modal-dialog">
      <h2>Hakkında</h2>
      <img src="img/about-logo.png" alt="Hakkında Logo" class="about-logo">
      <p style="margin-top:8px;font-size:12px;">2025 (C)</p>
      <p class="hint">Kapatmak için pencere dışına tıklayın.</p>
    </div>
  </div>

  <!-- Düzenleme PIN ayarı -->
  <div id="passwordSettingsOverlay" class="modal-backdrop">
    <div class="modal-dialog">
      <h2>Düzenleme PIN'i</h2>
      <p>Bu dosya için 4 haneli bir düzenleme PIN'i belirleyebilirsin. Tüm kutuları boş bırakırsan koruma kaldırılır.</p>
      <div class="pin-row" id="passwordSettingsPin">
        <input type="password" inputmode="numeric" maxlength="1" class="pin-box" autocomplete="off">
        <input type="password" inputmode="numeric" maxlength="1" class="pin-box" autocomplete="off">
        <input type="password" inputmode="numeric" maxlength="1" class="pin-box" autocomplete="off">
        <input type="password" inputmode="numeric" maxlength="1" class="pin-box" autocomplete="off">
      </div>
      <div class="modal-actions">
        <button id="passwordSettingsCancel">Vazgeç</button>
        <button id="passwordSettingsSave">Kaydet</button>
      </div>
    </div>
  </div>

  <!-- Düzenleme PIN prompt -->
  <div id="passwordPromptOverlay" class="modal-backdrop">
    <div class="modal-dialog">
      <h2>Düzenleme kilitli</h2>
      <p>Düzenleme moduna geçmek için PIN gir.</p>
      <div class="pin-row" id="passwordPromptPin">
        <input type="password" inputmode="numeric" maxlength="1" class="pin-box" autocomplete="off">
        <input type="password" inputmode="numeric" maxlength="1" class="pin-box" autocomplete="off">
        <input type="password" inputmode="numeric" maxlength="1" class="pin-box" autocomplete="off">
        <input type="password" inputmode="numeric" maxlength="1" class="pin-box" autocomplete="off">
      </div>
      <div class="modal-actions">
        <button id="passwordPromptCancel">İptal</button>
        <button id="passwordPromptOk">Devam</button>
      </div>
      <p class="hint">4 haneli PIN.</p>
    </div>
  </div>

  <!-- Proje bilgileri -->
  <div id="projectInfoOverlay" class="modal-backdrop">
    <div class="modal-dialog">
<h2 class="modal-title">
  <span style="font-size:28px;" class="material-symbols-outlined">apartment</span>
  Proje bilgileri
</h2>
      <p>Bu EPP dosyasına ait proje adını ve yükleniciyi kaydedebilirsin.</p>
      <label for="projectTypeSelect" style="margin-top:8px;">Proje Türü</label>
      <select id="projectTypeSelect">
        <option value="ETAP">Etap</option>
        <option value="ADA">Ada</option>
      </select>
      <label for="formworkTypeSelect" style="margin-top:8px;">Kalıp Türü</label>
      <select id="formworkTypeSelect">
        <option value="TÜNEL">Tünel Kalıp</option>
        <option value="KONVANSİYONEL">Konvansiyonel</option>
        <option value="HİBRİT">Hibrit</option>
      </select>
      <p class="hint">Hibrit, hem Tünel hem de Konvansiyonel olan şantiyeler içindir.</p>
      <label for="maxFloorsInput" style="margin-top:8px;">Maksimum Kat Sayısı</label>
      <input type="number" id="maxFloorsInput" min="1" max="99" placeholder="10" 
             style="width: 80px; text-align: center; font-size: 18px; font-weight: 600; padding: 8px;">
      <p class="hint">1-99 kat arası girilebilir.</p>
      <label for="projectNameInput" style="margin-top:12px;">Proje adı</label>
      <input type="text" id="projectNameInput" placeholder="Örn. KAHRAMANMARAŞ DULKADİROĞLU MERKEZ 15 2. ETAP 1. KISIM">
      <label for="projectContractorInput" style="margin-top:8px;">Yüklenici</label>
      <input type="text" id="projectContractorInput" placeholder="Örn. SUR YAPI Endüstri San. ve Tic. A.Ş.">
      <label for="projectContractorCodeInput" style="margin-top:8px;">Yüklenici Kodu</label>
      <input type="text" id="projectContractorCodeInput" placeholder="Örn. YD13">
      <label for="projectContractorShortInput" style="margin-top:8px;">Yüklenici Kısa Adı</label>
      <input type="text" id="projectContractorShortInput" placeholder="Örn. SUR">
      <div class="modal-actions">
        <button id="projectInfoCancel">Vazgeç</button>
        <button id="projectInfoSave">Kaydet</button>
      </div>
    </div>
  </div>

<div id="settingsOverlay" class="modal-backdrop">
  <div class="modal-dialog">
    <h3 class="modal-title">
      <span class="material-symbols-outlined">settings</span>
      <span>Ayarlar</span>
    </h2>
    <p>Grid ve etiket ayarlarını yapılandırabilirsin.</p>
    
    <h4 class="modal-subtitle" style="margin-top:16px;">
      <span class="material-symbols-outlined">grid_4x4</span>
      <span>Grid Ayarları</span>
    </h1>
    <label for="gridSizeInput" style="margin-top:8px;">Grid Boyutu (%)</label>
    <input type="number" id="gridSizeInput" min="25" max="200" step="25" placeholder="100" 
           style="width: 100px; text-align: center; font-size: 16px; font-weight: 600; padding: 8px;">
    <p class="hint">Grid snap hassasiyetini ayarlar. Küçük değer = daha çok grid. (25-200% arası)</p>
    
    <h4 class="modal-subtitle" style="margin-top:16px;">
      <span class="material-symbols-outlined">label</span>
      <span>Etiket Ayarları</span>
    </h4>
    <label for="labelFontSizeInput" style="margin-top:8px;">Etiket Boyutu (px)</label>
    <input type="number" id="labelFontSizeInput" min="4" max="24" placeholder="12" 
           style="width: 100px; text-align: center; font-size: 16px; font-weight: 600; padding: 8px;">
    <p class="hint">Blok etiketlerinin yazı boyutu. (4-24px arası)</p>
    
    <label for="labelOffsetXInput" style="margin-top:8px;">Etiket X Kaydırma (px)</label>
    <input type="number" id="labelOffsetXInput" min="-100" max="100" placeholder="0" 
           style="width: 100px; text-align: center; font-size: 16px; font-weight: 600; padding: 8px;">
    <p class="hint">Etiketlerin yatay pozisyonu. (-100 ile +100 arası)</p>
    
    <label for="labelOffsetYInput" style="margin-top:8px;">Etiket Y Kaydırma (px)</label>
    <input type="number" id="labelOffsetYInput" min="-100" max="100" placeholder="0" 
           style="width: 100px; text-align: center; font-size: 16px; font-weight: 600; padding: 8px;">
    <p class="hint">Etiketlerin dikey pozisyonu. (-100 ile +100 arası)</p>
    
    <div class="modal-actions" style="margin-top:16px;">
      <button id="settingsCancel">Vazgeç</button>
      <button id="settingsSave">Kaydet</button>
    </div>
  </div>
</div>


  <!-- Detay görseli büyük gösterme -->
  <div id="detailImageOverlay" class="modal-backdrop">
    <div class="modal-dialog" id="detailImageDialog">
      <img id="detailImageLarge" alt="Detay" />
    </div>
  </div>

  <!-- JSZip and XLSXPatcher -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="js/xlsx_patcher.js"></script>

  <!-- NCR System -->
  <script src="js/ncr-constants.js"></script>
  <script src="js/ncr-excel-patcher.js"></script>

  <!-- App scripts (order matters) -->
  <script src="js/constants.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/state.js"></script>
  <!-- Render modules (modular breakdown) -->
  <script src="js/render/render-hotspots.js"></script>
  <script src="js/render/render-carousel.js"></script>
  <script src="js/render/render-summary.js"></script>
  <script src="js/render/render-sidepanel.js"></script>
  <script src="js/render/render-ui.js"></script>
  <script src="js/render/render-drawing.js"></script>
  <!-- Events modules (modular breakdown) -->
  <script src="js/events/events-init.js"></script>
  <script src="js/events/events-modals.js"></script>
  <script src="js/events/events-toolbar.js"></script>
  <script src="js/events/events-canvas.js"></script>
  <script src="js/events/events-io.js"></script>
  <script src="js/events/events-hotspots.js"></script>
  <script src="js/events/events-shortcuts.js"></script>
  <!-- NCR Events -->
  <script src="js/events/events-ncr.js"></script>
</body>
</html>