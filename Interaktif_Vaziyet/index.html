<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>EPP 4NM - Ä°nteraktif Vaziyet PlanÄ±</title>

  <!-- Material Symbols Outlined (MD3 ikon seti) -->
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

  <!-- CSS Files: Base structure + Components -->
  <link rel="stylesheet" href="styles/base.css" />
  <link rel="stylesheet" href="styles/components.css" />
</head>
<body>
  <header>
    <img src="img/logo.png" alt="Logo" class="logo" />
    <span class="chip">Ä°nteraktif Vaziyet PlanÄ±</span>

    <span id="lastExportLabel" class="chip last-export">Son kayÄ±t: -</span>
    <span id="projectNameLabel" class="chip" style="display:none;"></span>

    <div class="spacer"></div>

    <button id="projectInfoBtn"
            class="icon-top-button"
            title="Proje bilgileri"
            style="display:none">
      <span class="material-symbols-outlined">info</span>
    </button>

    <button id="passwordSettingsBtn"
            class="icon-top-button"
            title="DÃ¼zenleme PIN'i"
            style="display:none">
      <span class="material-symbols-outlined">vpn_key</span>
    </button>

    <button id="settingsBtn"
            class="icon-top-button"
            title="Ayarlar"
            style="display:none">
      <span class="material-symbols-outlined">settings</span>
    </button>

    <div class="mode-toggle" id="modeToggle">
      <button data-mode="viewer" class="active">GÃ¶rÃ¼ntÃ¼le</button>
      <button data-mode="editor">DÃ¼zenle</button>
    </div>

    <button id="aboutBtn" class="icon-top-button" title="HakkÄ±nda">
      <span class="material-symbols-outlined">info</span>
    </button>
  </header>

  <main>
    <div class="canvas-column">
      <div class="toolbar">
        <label
          id="mainImageWrapper"
          class="icon-button"
          title="Ana gÃ¶rsel yÃ¼kle (yalnÄ±zca dÃ¼zenleme modunda)"
          style="display:none">
          <span class="material-symbols-outlined">image</span>
          <input type="file" id="mainImageInput" accept="image/*">
        </label>

        <label title="Ä°malat gÃ¶rÃ¼nÃ¼mÃ¼">
          <select id="workViewSelect"></select>
        </label>
        
        <span id="workViewStats" class="chip" style="display:none;font-size:11px;"></span>

        <button id="resetViewBtn" title="GÃ¶rÃ¼nÃ¼mÃ¼ sÄ±fÄ±rla">
          <span class="material-symbols-outlined">restart_alt</span>
        </button>
        <button id="panModeBtn" title="Pan modunu aÃ§/kapat">
          <span class="material-symbols-outlined">pan_tool_alt</span>
        </button>
        <button id="labelsBtn" title="Blok etiketlerini gÃ¶ster/gizle">
          <span class="material-symbols-outlined">label</span>
        </button>
        <button id="exportBtn" title="Kaydet">
          <span class="material-symbols-outlined">save</span>
        </button>
        <button id="importBtn" title="AÃ§">
          <span class="material-symbols-outlined">folder_open</span>
        </button>

        <div class="toolbar-separator"></div>

        <button id="summaryBtn" title="Puantaj">
          <span class="material-symbols-outlined">groups</span>
        </button>
        <button id="readyBtn" title="BaÅŸlayabilir Ä°malatlar">
          <span class="material-symbols-outlined">play_circle</span>
        </button>
        <button id="issuesBtn" title="Ä°malat SorunlarÄ±">
          <span class="material-symbols-outlined">warning</span>
        </button>

        <input type="file" id="importInput" accept=".epp,.zip,application/zip" style="display:none">
      </div>

      <div class="draw-toolbar" id="drawToolbar" style="display:none">
        <button id="addBlockBtn" title="Yeni blok oluÅŸtur">
          <span class="material-symbols-outlined">add_box</span>
        </button>
        <button id="drawLineBtn" title="Ã‡izgi Ã§iz">
          <span class="material-symbols-outlined">show_chart</span>
        </button>
        <button id="drawCurveBtn" title="EÄŸri Ã§iz">
          <span class="material-symbols-outlined">timeline</span>
        </button>
        <button id="addTextBtn" title="Metin ekle">
          <span class="material-symbols-outlined">text_fields</span>
        </button>
      </div>

      <div class="canvas-wrapper" id="canvasWrapper">
        <div id="viewport">
          <img id="mainImage" alt="Vaziyet planÄ±">
          <svg id="drawingLayer" style="position:absolute;top:0;left:0;pointer-events:none;width:100%;height:100%;"></svg>
          <div id="textLayer" style="position:absolute;top:0;left:0;pointer-events:none;"></div>
          <div id="hotspotLayer"></div>
        </div>
      </div>
    </div>

    <div id="asideBackdrop" class="aside-backdrop"></div>
    <aside>
      <header>Detaylar</header>
      <div class="side-body" id="sideBody"></div>
    </aside>
  </main>

  <!-- HakkÄ±nda -->
  <div id="aboutOverlay" class="modal-backdrop">
    <div class="modal-dialog">
      <h2>HakkÄ±nda</h2>
      <img src="img/about-logo.png" alt="HakkÄ±nda Logo" class="about-logo">
      <p style="margin-top:8px;font-size:12px;">2025 (C)</p>
      <p class="hint">Kapatmak iÃ§in pencere dÄ±ÅŸÄ±na tÄ±klayÄ±n.</p>
    </div>
  </div>

  <!-- DÃ¼zenleme PIN ayarÄ± -->
  <div id="passwordSettingsOverlay" class="modal-backdrop">
    <div class="modal-dialog">
      <h2>DÃ¼zenleme PIN'i</h2>
      <p>Bu dosya iÃ§in 4 haneli bir dÃ¼zenleme PIN'i belirleyebilirsin. TÃ¼m kutularÄ± boÅŸ bÄ±rakÄ±rsan koruma kaldÄ±rÄ±lÄ±r.</p>
      <div class="pin-row" id="passwordSettingsPin">
        <input type="password" inputmode="numeric" maxlength="1" class="pin-box" autocomplete="off">
        <input type="password" inputmode="numeric" maxlength="1" class="pin-box" autocomplete="off">
        <input type="password" inputmode="numeric" maxlength="1" class="pin-box" autocomplete="off">
        <input type="password" inputmode="numeric" maxlength="1" class="pin-box" autocomplete="off">
      </div>
      <div class="modal-actions">
        <button id="passwordSettingsCancel">VazgeÃ§</button>
        <button id="passwordSettingsSave">Kaydet</button>
      </div>
      <p class="hint">Bu PIN EPP iÃ§indeki config.json'da dÃ¼z metin olarak saklanÄ±r.</p>
    </div>
  </div>

  <!-- DÃ¼zenleme PIN prompt -->
  <div id="passwordPromptOverlay" class="modal-backdrop">
    <div class="modal-dialog">
      <h2>DÃ¼zenleme kilitli</h2>
      <p>DÃ¼zenleme moduna geÃ§mek iÃ§in PIN gir.</p>
      <div class="pin-row" id="passwordPromptPin">
        <input type="password" inputmode="numeric" maxlength="1" class="pin-box" autocomplete="off">
        <input type="password" inputmode="numeric" maxlength="1" class="pin-box" autocomplete="off">
        <input type="password" inputmode="numeric" maxlength="1" class="pin-box" autocomplete="off">
        <input type="password" inputmode="numeric" maxlength="1" class="pin-box" autocomplete="off">
      </div>
      <div class="modal-actions">
        <button id="passwordPromptCancel">Ä°ptal</button>
        <button id="passwordPromptOk">Devam</button>
      </div>
      <p class="hint">4 haneli PIN.</p>
    </div>
  </div>

  <!-- Proje bilgileri -->
  <div id="projectInfoOverlay" class="modal-backdrop">
    <div class="modal-dialog">
      <h2>Proje bilgileri</h2>
      <p>Bu EPP dosyasÄ±na ait proje adÄ±nÄ± ve yÃ¼kleniciyi kaydedebilirsin.</p>
      <label for="projectTypeSelect" style="margin-top:8px;">Proje TÃ¼rÃ¼</label>
      <select id="projectTypeSelect">
        <option value="ETAP">ETAP</option>
        <option value="ADA">ADA</option>
      </select>
      <label for="formworkTypeSelect" style="margin-top:8px;">KalÄ±p TÃ¼rÃ¼</label>
      <select id="formworkTypeSelect">
        <option value="TÃœNEL">TÃœNEL</option>
        <option value="KONVANSÄ°YONEL">KONVANSÄ°YONEL</option>
        <option value="HÄ°BRÄ°T">HÄ°BRÄ°T</option>
      </select>
      <label for="maxFloorsInput" style="margin-top:8px;">Maksimum Kat SayÄ±sÄ±</label>
      <input type="number" id="maxFloorsInput" min="1" max="99" placeholder="10" 
             style="width: 80px; text-align: center; font-size: 18px; font-weight: 600; padding: 8px;">
      <p class="hint">1-99 kat arasÄ± girilebilir.</p>
      <label for="projectNameInput" style="margin-top:12px;">Proje adÄ±</label>
      <input type="text" id="projectNameInput" placeholder="Ã–rn. KAHRAMANMARAÅ DULKADÄ°ROÄLU MERKEZ 15 2. ETAP 1. KISIM">
      <label for="projectContractorInput" style="margin-top:8px;">YÃ¼klenici</label>
      <input type="text" id="projectContractorInput" placeholder="Ã–rn. SUR YAPI EndÃ¼stri San. ve Tic. A.Å.">
      <label for="projectContractorCodeInput" style="margin-top:8px;">YÃ¼klenici Kodu</label>
      <input type="text" id="projectContractorCodeInput" placeholder="Ã–rn. YD13">
      <label for="projectContractorShortInput" style="margin-top:8px;">YÃ¼klenici KÄ±sa AdÄ±</label>
      <input type="text" id="projectContractorShortInput" placeholder="Ã–rn. SUR">
      <div class="modal-actions">
        <button id="projectInfoCancel">VazgeÃ§</button>
        <button id="projectInfoSave">Kaydet</button>
      </div>
      <p class="hint">Bu bilgiler EPP iÃ§indeki config.json'da dÃ¼z metin olarak saklanÄ±r.</p>
    </div>
  </div>

  <!-- Ayarlar -->
  <div id="settingsOverlay" class="modal-backdrop">
    <div class="modal-dialog">
      <h2>âš™ï¸ Ayarlar</h2>
      <p>Grid ve etiket ayarlarÄ±nÄ± yapÄ±landÄ±rabilirsin.</p>
      
      <h3 style="margin-top:16px;font-size:14px;color:#e5e7eb;">ğŸ”² Grid AyarlarÄ±</h3>
      <label for="gridSizeInput" style="margin-top:8px;">Grid Boyutu (%)</label>
      <input type="number" id="gridSizeInput" min="25" max="200" step="25" placeholder="100" 
             style="width: 100px; text-align: center; font-size: 16px; font-weight: 600; padding: 8px;">
      <p class="hint">Grid snap hassasiyetini ayarlar. KÃ¼Ã§Ã¼k deÄŸer = daha Ã§ok grid. (25-200% arasÄ±)</p>
      
      <h3 style="margin-top:16px;font-size:14px;color:#e5e7eb;">ğŸ·ï¸ Etiket AyarlarÄ±</h3>
      <label for="labelFontSizeInput" style="margin-top:8px;">Etiket Boyutu (px)</label>
      <input type="number" id="labelFontSizeInput" min="8" max="24" placeholder="12" 
             style="width: 100px; text-align: center; font-size: 16px; font-weight: 600; padding: 8px;">
      <p class="hint">Blok etiketlerinin yazÄ± boyutu. (8-24px arasÄ±)</p>
      
      <label for="labelOffsetXInput" style="margin-top:8px;">Etiket X KaydÄ±rma (px)</label>
      <input type="number" id="labelOffsetXInput" min="-100" max="100" placeholder="0" 
             style="width: 100px; text-align: center; font-size: 16px; font-weight: 600; padding: 8px;">
      <p class="hint">Etiketlerin yatay pozisyonu. (-100 ile +100 arasÄ±)</p>
      
      <label for="labelOffsetYInput" style="margin-top:8px;">Etiket Y KaydÄ±rma (px)</label>
      <input type="number" id="labelOffsetYInput" min="-100" max="100" placeholder="0" 
             style="width: 100px; text-align: center; font-size: 16px; font-weight: 600; padding: 8px;">
      <p class="hint">Etiketlerin dikey pozisyonu. (-100 ile +100 arasÄ±)</p>
      
      <div class="modal-actions" style="margin-top:16px;">
        <button id="settingsCancel">VazgeÃ§</button>
        <button id="settingsSave">Kaydet</button>
      </div>
      <p class="hint">Ayarlar EPP iÃ§indeki config.json'da saklanÄ±r.</p>
    </div>
  </div>

  <!-- Detay gÃ¶rseli bÃ¼yÃ¼k gÃ¶sterme -->
  <div id="detailImageOverlay" class="modal-backdrop">
    <div class="modal-dialog" id="detailImageDialog">
      <img id="detailImageLarge" alt="Detay" />
    </div>
  </div>

  <!-- JSZip and XLSXPatcher -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="js/xlsx_patcher.js"></script>

  <!-- NCR System -->
  <script src="js/ncr-constants.js"></script>
  <script src="js/ncr-excel-patcher.js"></script>

  <!-- App scripts (order matters) -->
  <script src="js/constants.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/state.js"></script>
  <!-- Render modules (modular breakdown) -->
  <script src="js/render/render-hotspots.js"></script>
  <script src="js/render/render-carousel.js"></script>
  <script src="js/render/render-summary.js"></script>
  <script src="js/render/render-sidepanel.js"></script>
  <script src="js/render/render-ui.js"></script>
  <script src="js/render/render-drawing.js"></script>
  <!-- Events modules (modular breakdown) -->
  <script src="js/events/events-init.js"></script>
  <script src="js/events/events-modals.js"></script>
  <script src="js/events/events-toolbar.js"></script>
  <script src="js/events/events-canvas.js"></script>
  <script src="js/events/events-io.js"></script>
  <script src="js/events/events-hotspots.js"></script>
  <script src="js/events/events-shortcuts.js"></script>
  <!-- NCR Events -->
  <script src="js/events/events-ncr.js"></script>
</body>
</html>